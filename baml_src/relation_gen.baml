// Defining a raw unit of knowledge.
class Triple {
  subjectIRI string // Should be as generic as possible
  predicateIRI string 
  objectIRI string 
}

// Create a function to extract triples from text.
function ExtractTriples(text: string, named_entities: string, ontology_text: string) -> Triple[] {
  client Gemini

  prompt #"
    You need to generate valid triples from the text.
    
    Follow these requirements:
      1) Using the given ontology.
      2) Referencing the entity list as hints. 
      3) Do not use the entity list as the only source of truth, be sure to reference the original text for the source of truth.
    
    Be sure to type all entities with the http://www.w3.org/1999/02/22-rdf-syntax-ns#type predicate.

    Be sure that all generated entities are within the base IRI of the ontology.
    
    Ontology:
    {{ ontology_text }}

    Entities:
    {{ named_entities }}

    Extract from this content (Original Text):
    {{ text }}

    {{ ctx.output_format }}
  "#
}

// Test the function with a sample resume. Open the VSCode playground to run this.
test wikipedia_bee {
  functions [ExtractTriples]
  args {
    text #"
      Bees are found on every continent except Antarctica, 
      in every habitat on the planet that contains insect-pollinated
      flowering plants.
    "#
  }
}

test invalid_pizza_ontology {
  functions [ExtractTriples]
  args {
    ontology_text #"
    <?xml version="1.0"?>
    <rdf:RDF xmlns="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2/"
         xml:base="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2/"
         xmlns:owl="http://www.w3.org/2002/07/owl#"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:xml="http://www.w3.org/XML/1998/namespace"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
         xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
         xmlns:untitled-ontology-2="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#">
        <owl:Ontology rdf:about="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2"/>
        
    
    
        <!-- 
        ///////////////////////////////////////////////////////////////////////////////////////
        //
        // Object Properties
        //
        ///////////////////////////////////////////////////////////////////////////////////////
         -->
    
        
    
    
        <!-- http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#hasTopping -->
    
        <owl:ObjectProperty rdf:about="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#hasTopping">
            <rdfs:domain rdf:resource="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#Pizza"/>
            <rdfs:range rdf:resource="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#Ingredient"/>
        </owl:ObjectProperty>
        
    
    
        <!-- 
        ///////////////////////////////////////////////////////////////////////////////////////
        //
        // Classes
        //
        ///////////////////////////////////////////////////////////////////////////////////////
         -->
    
        
    
    
        <!-- http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#Ingredient -->
    
        <owl:Class rdf:about="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#Ingredient">
            <owl:disjointWith rdf:resource="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#Pizza"/>
        </owl:Class>
        
    
    
        <!-- http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#Pizza -->
    
        <owl:Class rdf:about="http://www.semanticweb.org/dylan/ontologies/2025/1/untitled-ontology-2#Pizza"/>
    
    </rdf:RDF>
    
    
    
    <!-- Generated by the OWL API (version 4.5.29.2024-05-13T12:11:03Z) https://github.com/owlcs/owlapi -->
    "#

    named_entities "MegaPizza, Pepperoni, Pizza, toppings, cheese, sauce, MegaPizza, Cheese, Pizza, Pepperoni, Pizza, toppings"

    text #"
      Pepperoni Pizza has pepperonni toppings and cheese and red sauce. The 'MegaPizza' contains Cheese Pizza and Pepperoni Pizza as toppings
    "#
  }
}
